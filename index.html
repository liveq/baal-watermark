<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ë¬´ë£Œ ì›Œí„°ë§ˆí¬ ì¶”ê°€ ë„êµ¬. ì´ë¯¸ì§€ì— í…ìŠ¤íŠ¸/ë¡œê³  ì›Œí„°ë§ˆí¬ë¥¼ ì¶”ê°€í•˜ì„¸ìš”. ìœ„ì¹˜, íˆ¬ëª…ë„, íšŒì „ ì¡°ì ˆ ê°€ëŠ¥.">
    <meta name="keywords" content="ì›Œí„°ë§ˆí¬ ì¶”ê°€, ì´ë¯¸ì§€ ì›Œí„°ë§ˆí¬, ë¡œê³  ì‚½ì…, ì €ì‘ê¶Œ ë³´í˜¸, ì‚¬ì§„ ì›Œí„°ë§ˆí¬, ë¬´ë£Œ ì›Œí„°ë§ˆí¬, ì›Œí„°ë§ˆí¬ ë§Œë“¤ê¸°">
    <meta name="author" content="BAAL">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://watermark.baal.co.kr/">
    <meta property="og:title" content="ì›Œí„°ë§ˆí¬ ì¶”ê°€ - ë¬´ë£Œ ì˜¨ë¼ì¸ ë„êµ¬">
    <meta property="og:description" content="ì´ë¯¸ì§€ì— í…ìŠ¤íŠ¸/ë¡œê³  ì›Œí„°ë§ˆí¬ë¥¼ ë¬´ë£Œë¡œ ì¶”ê°€í•˜ì„¸ìš”. íˆ¬ëª…ë„/ìœ„ì¹˜/íšŒì „ ì¡°ì ˆ.">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://watermark.baal.co.kr/">
    <meta property="twitter:title" content="ì›Œí„°ë§ˆí¬ ì¶”ê°€ - ë¬´ë£Œ ì˜¨ë¼ì¸ ë„êµ¬">
    <meta property="twitter:description" content="ì´ë¯¸ì§€ì— í…ìŠ¤íŠ¸/ë¡œê³  ì›Œí„°ë§ˆí¬ë¥¼ ë¬´ë£Œë¡œ ì¶”ê°€í•˜ì„¸ìš”.">

    <title>ì›Œí„°ë§ˆí¬ ì¶”ê°€ - BAAL</title>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2886185075996969"
     crossorigin="anonymous"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX');
    </script>

    <!-- JSZip (ZIP ë‹¤ìš´ë¡œë“œìš©) -->
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

    <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="_common/common.css">
    <style>
        /* ì›Œí„°ë§ˆí¬ íƒ€ì… ì„ íƒ */
        .type-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .type-tab {
            flex: 1;
            max-width: 200px;
            padding: 16px 32px;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: 600;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1em;
            text-align: center;
        }

        .type-tab:hover {
            border-color: var(--gold-primary);
            background: var(--bg-accent);
        }

        .type-tab.active {
            background: var(--gold-gradient);
            color: white;
            border-color: var(--gold-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        /* ì„¤ì • ì„¹ì…˜ */
        .settings-section {
            background: var(--bg-accent);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 25px;
            margin-bottom: 25px;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-group:last-child {
            margin-bottom: 0;
        }

        .setting-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .setting-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-md);
            font-size: 1em;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        /* ìœ„ì¹˜ ì„ íƒ ì˜ì—­ */
        .position-section {
            display: flex;
            gap: 20px;
            align-items: stretch;
        }

        /* ìœ„ì¹˜ ì„ íƒ ê·¸ë¦¬ë“œ */
        .position-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            width: 200px;
            flex-shrink: 0;
        }

        .position-btn {
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: horizontal-tb;
            white-space: nowrap;
        }

        .position-btn:hover {
            border-color: var(--gold-primary);
            background: var(--bg-accent);
        }

        .position-btn.active {
            background: var(--gold-gradient);
            color: white;
            border-color: var(--gold-primary);
        }

        /* ìœ„ì¹˜ ë¯¸ë¦¬ë³´ê¸° */
        .position-preview {
            flex: 1;
            background: transparent;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .position-preview-box {
            width: 100%;
            max-width: 480px;
            aspect-ratio: 16 / 9;
            background: #e0e0e0;
            position: relative;
            border-radius: 4px;
            overflow: hidden;
        }

        .position-preview-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .position-preview-watermark {
            position: absolute;
            white-space: nowrap;
            pointer-events: none;
            font-weight: bold;
            transform-origin: center;
        }

        .position-preview-size {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #999;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            pointer-events: none;
            z-index: 1;
        }

        .position-preview-size.hidden {
            display: none;
        }

        /* ìŠ¬ë¼ì´ë” */
        .slider-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--gold-primary);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--gold-primary);
            cursor: pointer;
            border: none;
        }

        .slider-value {
            min-width: 60px;
            font-weight: 600;
            color: var(--text-primary);
            text-align: right;
        }

        /* ìƒ‰ìƒ í”½ì»¤ */
        .color-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        input[type="color"] {
            width: 60px;
            height: 40px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            background: var(--bg-secondary);
        }

        .color-value {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 80px;
        }

        /* ì²´í¬ë°•ìŠ¤ */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            user-select: none;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* ë¯¸ë¦¬ë³´ê¸° */
        .preview-container {
            background: var(--bg-accent);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            margin-bottom: 25px;
            text-align: center;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #previewCanvas {
            max-width: 100%;
            max-height: 500px;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
        }

        .preview-placeholder {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        /* íŒŒì¼ ë¦¬ìŠ¤íŠ¸ */
        .file-list {
            margin-top: 20px;
        }

        .file-item {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-md);
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .file-status {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        /* ë²„íŠ¼ */
        .btn-process {
            padding: 16px 48px;
            background: var(--gold-gradient);
            color: white;
            border: 2px solid var(--gold-primary);
            border-radius: var(--border-radius-md);
            font-weight: 700;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 auto;
            display: block;
        }

        .btn-process:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-process:active {
            transform: translateY(0);
        }

        .btn-process:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .download-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .btn-download {
            padding: 14px 32px;
            background: var(--gold-gradient);
            color: white;
            border: 2px solid var(--gold-primary);
            border-radius: var(--border-radius-md);
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .type-tabs {
                flex-direction: column;
            }

            .type-tab {
                max-width: none;
            }

            .position-grid {
                max-width: none;
            }

            .slider-group {
                flex-direction: column;
                align-items: flex-start;
            }

            .slider-value {
                width: 100%;
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ -->
    <div class="theme-toggle">
        <button id="themeToggle" aria-label="ë‹¤í¬ëª¨ë“œ ì „í™˜">
            <span class="icon-light">â˜€ï¸</span>
            <span class="icon-dark">ğŸŒ™</span>
        </button>
    </div>

    <!-- ì–¸ì–´ ì „í™˜ & ë„êµ¬ ë²„íŠ¼ -->
    <div class="lang-toggle">
        <button id="langToggle" data-lang="ko">
            <span class="lang-ko">EN</span>
            <span class="lang-en">KO</span>
        </button>
        <button id="toolsToggle">
            <span class="tooltip" data-ko="ë” ë§ì€ ë„êµ¬" data-en="More Tools">ë” ë§ì€ ë„êµ¬</span>
            ğŸ§°
        </button>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
        <header>
            <h1 data-ko="ì›Œí„°ë§ˆí¬ ì¶”ê°€" data-en="Add Watermark">ì›Œí„°ë§ˆí¬ ì¶”ê°€</h1>
            <p class="subtitle" data-ko="ì´ë¯¸ì§€ì— í…ìŠ¤íŠ¸/ë¡œê³  ì›Œí„°ë§ˆí¬ë¥¼ ì¶”ê°€í•˜ì„¸ìš”" data-en="Add text/logo watermark to images">ì´ë¯¸ì§€ì— í…ìŠ¤íŠ¸/ë¡œê³  ì›Œí„°ë§ˆí¬ë¥¼ ì¶”ê°€í•˜ì„¸ìš”</p>
        </header>

        <main>
            <!-- ğŸ·ï¸ ì›Œí„°ë§ˆí¬ íƒ€ì… & ì„¤ì • -->
            <div class="settings-section">
                <label class="setting-label">
                    <span data-ko="ğŸ·ï¸ ì›Œí„°ë§ˆí¬ íƒ€ì… & ì„¤ì •" data-en="ğŸ·ï¸ Watermark Type & Settings">ğŸ·ï¸ ì›Œí„°ë§ˆí¬ íƒ€ì… & ì„¤ì •</span>
                </label>
                <div class="type-tabs">
                    <button class="type-tab active" data-type="text" data-ko="ğŸ“ í…ìŠ¤íŠ¸" data-en="ğŸ“ Text">ğŸ“ í…ìŠ¤íŠ¸</button>
                    <button class="type-tab" data-type="image" data-ko="ğŸ–¼ï¸ ì´ë¯¸ì§€/ë¡œê³ " data-en="ğŸ–¼ï¸ Image/Logo">ğŸ–¼ï¸ ì´ë¯¸ì§€/ë¡œê³ </button>
                </div>

                <!-- í…ìŠ¤íŠ¸ ì›Œí„°ë§ˆí¬ ì„¤ì • -->
                <div id="textSettings">
                    <div class="setting-group">
                        <label class="setting-label" for="watermarkText" data-ko="í…ìŠ¤íŠ¸" data-en="Text">í…ìŠ¤íŠ¸</label>
                        <input type="text" id="watermarkText" class="setting-input" placeholder="Copyright Â© 2025" data-ko-placeholder="Copyright Â© 2025" data-en-placeholder="Copyright Â© 2025">
                    </div>

                    <div class="setting-group">
                        <label class="setting-label" data-ko="í°íŠ¸ í¬ê¸°" data-en="Font Size">í°íŠ¸ í¬ê¸°</label>
                        <div class="slider-group">
                            <input type="range" id="fontSize" min="12" max="120" value="48" step="4">
                            <span class="slider-value" id="fontSizeValue">48px</span>
                        </div>
                    </div>

                    <div class="setting-group">
                        <label class="setting-label" data-ko="ìƒ‰ìƒ" data-en="Color">ìƒ‰ìƒ</label>
                        <div class="color-group">
                            <input type="color" id="textColor" value="#ffffff">
                            <span class="color-value" id="textColorValue">#ffffff</span>
                        </div>
                    </div>
                </div>

                <!-- ì´ë¯¸ì§€ ì›Œí„°ë§ˆí¬ ì„¤ì • -->
                <div id="imageSettings" style="display: none;">
                    <div class="setting-group">
                        <label class="setting-label" data-ko="ë¡œê³  ì´ë¯¸ì§€ ì—…ë¡œë“œ" data-en="Upload Logo Image">ë¡œê³  ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
                        <input type="file" id="logoInput" accept="image/*" class="setting-input">
                    </div>

                    <div class="setting-group">
                        <label class="setting-label" data-ko="í¬ê¸°" data-en="Scale">í¬ê¸°</label>
                        <div class="slider-group">
                            <input type="range" id="logoScale" min="5" max="50" value="20" step="5">
                            <span class="slider-value" id="logoScaleValue">20%</span>
                        </div>
                    </div>
                </div>

                <!-- ê³µí†µ ì„¤ì • -->
                <div class="setting-group">
                    <label class="setting-label" data-ko="íˆ¬ëª…ë„" data-en="Opacity">íˆ¬ëª…ë„</label>
                    <div class="slider-group">
                        <input type="range" id="opacity" min="0" max="100" value="50" step="5">
                        <span class="slider-value" id="opacityValue">50%</span>
                    </div>
                </div>

                <div class="setting-group">
                    <label class="setting-label" data-ko="ìœ„ì¹˜" data-en="Position">ìœ„ì¹˜</label>
                    <div class="position-section">
                        <div class="position-grid">
                            <button class="position-btn" data-position="top-left" data-ko="ì¢Œìƒ" data-en="TL">ì¢Œìƒ</button>
                            <button class="position-btn" data-position="top-center" data-ko="ì¤‘ìƒ" data-en="TC">ì¤‘ìƒ</button>
                            <button class="position-btn" data-position="top-right" data-ko="ìš°ìƒ" data-en="TR">ìš°ìƒ</button>
                            <button class="position-btn" data-position="center-left" data-ko="ì¢Œì¤‘" data-en="CL">ì¢Œì¤‘</button>
                            <button class="position-btn" data-position="center" data-ko="ì¤‘ì•™" data-en="C">ì¤‘ì•™</button>
                            <button class="position-btn" data-position="center-right" data-ko="ìš°ì¤‘" data-en="CR">ìš°ì¤‘</button>
                            <button class="position-btn" data-position="bottom-left" data-ko="ì¢Œí•˜" data-en="BL">ì¢Œí•˜</button>
                            <button class="position-btn" data-position="bottom-center" data-ko="ì¤‘í•˜" data-en="BC">ì¤‘í•˜</button>
                            <button class="position-btn active" data-position="bottom-right" data-ko="ìš°í•˜" data-en="BR">ìš°í•˜</button>
                        </div>
                        <div class="position-preview" id="positionPreview">
                            <div class="position-preview-box" id="previewBox">
                                <div class="position-preview-size" id="previewSize">1920 Ã— 1080 px<br><span style="font-size: 12px; color: #aaa;">(16:9 Full HD)</span></div>
                                <span class="position-preview-watermark" id="previewWatermark">WATERMARK</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <label class="setting-label" data-ko="íšŒì „" data-en="Rotation">íšŒì „</label>
                    <div class="slider-group">
                        <input type="range" id="rotation" min="-180" max="180" value="0" step="15">
                        <span class="slider-value" id="rotationValue">0Â°</span>
                    </div>
                </div>

                <div class="setting-group">
                    <label class="checkbox-group">
                        <input type="checkbox" id="shadowToggle">
                        <span data-ko="ê·¸ë¦¼ì íš¨ê³¼" data-en="Shadow Effect">ê·¸ë¦¼ì íš¨ê³¼</span>
                    </label>
                </div>
            </div>

            <!-- ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
            <div class="dropzone" id="dropzone">
                <p>
                    <span data-ko="ğŸ“¤ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ (ìµœëŒ€ 20ê°œ)" data-en="ğŸ“¤ Drag & drop images or click to upload (Max 20)">ğŸ“¤ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ (ìµœëŒ€ 20ê°œ)</span>
                </p>
                <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
            </div>

            <div class="file-list" id="fileList" style="display: none;"></div>

            <!-- ì²˜ë¦¬ ë²„íŠ¼ -->
            <div style="margin: 30px 0; text-align: center;" id="processSection" style="display: none;">
                <button class="btn-process" id="processBtn" data-ko="ì›Œí„°ë§ˆí¬ ì ìš©" data-en="Apply Watermark">ì›Œí„°ë§ˆí¬ ì ìš©</button>
            </div>

            <!-- ğŸ–¼ï¸ ë¯¸ë¦¬ë³´ê¸° -->
            <div class="preview-container">
                <p class="preview-placeholder" id="placeholder" data-ko="ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê³  ì›Œí„°ë§ˆí¬ë¥¼ ì ìš©í•˜ì„¸ìš”" data-en="Upload images and apply watermark">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê³  ì›Œí„°ë§ˆí¬ë¥¼ ì ìš©í•˜ì„¸ìš”</p>
                <canvas id="previewCanvas" style="display: none;"></canvas>
            </div>

            <!-- ì¸ë„¤ì¼ íŒ”ë ˆíŠ¸ -->
            <div id="thumbnailPalette" style="display: none; margin-top: 15px; background: var(--bg-accent); border: 2px solid var(--border-color); border-radius: var(--border-radius-lg); padding: 20px;">
                <label class="setting-label" data-ko="ì „ì²´ ì²˜ë¦¬ëœ ì´ë¯¸ì§€" data-en="All Processed Images">ì „ì²´ ì²˜ë¦¬ëœ ì´ë¯¸ì§€</label>
                <div id="thumbnailGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; margin-top: 12px;"></div>
            </div>

            <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
            <div class="download-buttons" id="downloadButtons" style="display: none;">
                <button class="btn-download" id="downloadAllBtn" data-ko="ì „ì²´ ZIP ë‹¤ìš´ë¡œë“œ" data-en="Download All as ZIP">ì „ì²´ ZIP ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </main>

        <footer>
            <div class="footer-content">
                <p class="footer-brand">
                    Made by <a href="https://baal.co.kr" target="_blank">BAAL</a>
                </p>
                <p class="footer-contact">
                    <a href="mailto:baal.contract@gmail.com">baal.contract@gmail.com</a>
                </p>
                <p class="footer-links">
                    <a href="https://baal.co.kr/privacy" target="_blank" data-ko="ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨" data-en="Privacy Policy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                    <span class="separator">|</span>
                    <a href="https://baal.co.kr/terms" target="_blank" data-ko="ì´ìš©ì•½ê´€" data-en="Terms of Service">ì´ìš©ì•½ê´€</a>
                </p>
                <p class="footer-copyright">&copy; 2025 BAAL. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="_common/common.js"></script>
    <script>
        // ê°•ì œë¡œ ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }
        window.scrollTo(0, 0);

        window.addEventListener('load', () => {
            window.scrollTo(0, 0);
        });

        document.addEventListener('DOMContentLoaded', () => {
            window.scrollTo(0, 0);

            // ì…ë ¥ê°’ ì´ˆê¸°í™” (ìƒˆë¡œê³ ì¹¨ ì‹œ)
            document.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(el => {
                el.value = '';
            });

            // ì´ˆê¸° ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
            setTimeout(() => {
                updatePositionPreview();
            }, 100);
        });

        let currentType = 'text';
        let currentPosition = 'bottom-right';
        let files = [];
        let processedFiles = [];
        let logoImage = null;

        // íƒ€ì… ì„ íƒ
        document.querySelectorAll('.type-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                currentType = tab.dataset.type;

                document.querySelectorAll('.type-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // ì„¤ì • í‘œì‹œ/ìˆ¨ê¹€
                if (currentType === 'text') {
                    document.getElementById('textSettings').style.display = 'block';
                    document.getElementById('imageSettings').style.display = 'none';
                } else {
                    document.getElementById('textSettings').style.display = 'none';
                    document.getElementById('imageSettings').style.display = 'block';
                }
            });
        });

        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updatePositionPreview() {
            const watermark = document.getElementById('previewWatermark');
            const previewBox = document.getElementById('previewBox');

            // ì›Œí„°ë§ˆí¬ í…ìŠ¤íŠ¸
            const text = document.getElementById('watermarkText').value || 'WATERMARK';
            watermark.textContent = text;

            // í°íŠ¸ í¬ê¸° ìŠ¤ì¼€ì¼ë§ (ì‹¤ì œ ì´ë¯¸ì§€ í¬ê¸° ê¸°ì¤€ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸° í¬ê¸° ì¡°ì •)
            const fontSize = document.getElementById('fontSize').value;
            const previewWidth = previewBox.offsetWidth;
            const scaleFactor = previewWidth / 1920; // 1920pxì„ ê¸°ì¤€ ì´ë¯¸ì§€ í¬ê¸°ë¡œ ê°€ì •
            const scaledFontSize = fontSize * scaleFactor;
            watermark.style.fontSize = scaledFontSize + 'px';

            // ìƒ‰ìƒ
            const color = document.getElementById('textColor').value;
            watermark.style.color = color;

            // íˆ¬ëª…ë„
            const opacity = document.getElementById('opacity').value / 100;
            watermark.style.opacity = opacity;

            // íšŒì „
            const rotation = document.getElementById('rotation').value;
            watermark.style.transform = `rotate(${rotation}deg)`;

            // ê·¸ë¦¼ì
            const shadow = document.getElementById('shadowToggle').checked;
            if (shadow) {
                const shadowSize = 2 * scaleFactor;
                watermark.style.textShadow = `${shadowSize}px ${shadowSize}px ${shadowSize * 2}px rgba(0,0,0,0.5)`;
            } else {
                watermark.style.textShadow = 'none';
            }

            // ìœ„ì¹˜
            const boxWidth = previewBox.offsetWidth;
            const boxHeight = previewBox.offsetHeight;
            const padding = 20 * scaleFactor;

            watermark.style.left = '';
            watermark.style.right = '';
            watermark.style.top = '';
            watermark.style.bottom = '';
            watermark.style.transform += ' translate(-50%, -50%)';

            switch(currentPosition) {
                case 'top-left':
                    watermark.style.left = padding + 'px';
                    watermark.style.top = padding + 'px';
                    watermark.style.transform = `rotate(${rotation}deg)`;
                    break;
                case 'top-center':
                    watermark.style.left = '50%';
                    watermark.style.top = padding + 'px';
                    watermark.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
                    break;
                case 'top-right':
                    watermark.style.right = padding + 'px';
                    watermark.style.top = padding + 'px';
                    watermark.style.transform = `rotate(${rotation}deg)`;
                    break;
                case 'center-left':
                    watermark.style.left = padding + 'px';
                    watermark.style.top = '50%';
                    watermark.style.transform = `translateY(-50%) rotate(${rotation}deg)`;
                    break;
                case 'center':
                    watermark.style.left = '50%';
                    watermark.style.top = '50%';
                    watermark.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
                    break;
                case 'center-right':
                    watermark.style.right = padding + 'px';
                    watermark.style.top = '50%';
                    watermark.style.transform = `translateY(-50%) rotate(${rotation}deg)`;
                    break;
                case 'bottom-left':
                    watermark.style.left = padding + 'px';
                    watermark.style.bottom = padding + 'px';
                    watermark.style.transform = `rotate(${rotation}deg)`;
                    break;
                case 'bottom-center':
                    watermark.style.left = '50%';
                    watermark.style.bottom = padding + 'px';
                    watermark.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
                    break;
                case 'bottom-right':
                    watermark.style.right = padding + 'px';
                    watermark.style.bottom = padding + 'px';
                    watermark.style.transform = `rotate(${rotation}deg)`;
                    break;
            }
        }

        // ìœ„ì¹˜ ì„ íƒ
        document.querySelectorAll('.position-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentPosition = btn.dataset.position;
                document.querySelectorAll('.position-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updatePositionPreview();
            });
        });

        // ì›Œí„°ë§ˆí¬ í…ìŠ¤íŠ¸
        document.getElementById('watermarkText').addEventListener('input', updatePositionPreview);

        // ìŠ¬ë¼ì´ë”
        document.getElementById('fontSize').addEventListener('input', (e) => {
            document.getElementById('fontSizeValue').textContent = e.target.value + 'px';
            updatePositionPreview();
        });

        document.getElementById('logoScale').addEventListener('input', (e) => {
            document.getElementById('logoScaleValue').textContent = e.target.value + '%';
        });

        document.getElementById('opacity').addEventListener('input', (e) => {
            document.getElementById('opacityValue').textContent = e.target.value + '%';
            updatePositionPreview();
        });

        document.getElementById('rotation').addEventListener('input', (e) => {
            document.getElementById('rotationValue').textContent = e.target.value + 'Â°';
            updatePositionPreview();
        });

        // ìƒ‰ìƒ
        document.getElementById('textColor').addEventListener('input', (e) => {
            document.getElementById('textColorValue').textContent = e.target.value;
            updatePositionPreview();
        });

        // ê·¸ë¦¼ì í† ê¸€
        document.getElementById('shadowToggle').addEventListener('change', updatePositionPreview);

        // ë¡œê³  ì—…ë¡œë“œ
        document.getElementById('logoInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                logoImage = new Image();
                logoImage.src = URL.createObjectURL(file);
                await logoImage.decode();
                window.BaalUtils.showToast('ë¡œê³  ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success', 5000);
            }
        });

        // íŒŒì¼ ì—…ë¡œë“œ
        window.BaalUtils.initDropzone('dropzone', 'fileInput', handleFiles, {
            accept: 'image/*',
            maxFiles: 20,
            maxSize: 10 * 1024 * 1024
        });

        function handleFiles(fileArray) {
            files = fileArray;
            processedFiles = [];

            document.getElementById('fileList').style.display = 'block';
            document.getElementById('processSection').style.display = 'block';
            renderFileList();

            // ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë¥¼ ë¯¸ë¦¬ë³´ê¸°ì— í‘œì‹œ
            if (files.length > 0) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const previewBox = document.getElementById('previewBox');
                    const previewSize = document.getElementById('previewSize');

                    // ì‚¬ì´ì¦ˆ í‘œì‹œ ìˆ¨ê¸°ê¸°
                    if (previewSize) {
                        previewSize.classList.add('hidden');
                    }

                    previewBox.style.background = 'transparent';
                    previewBox.innerHTML = `
                        <img src="${e.target.result}" class="position-preview-image">
                        <span class="position-preview-watermark" id="previewWatermark">WATERMARK</span>
                    `;
                    updatePositionPreview();
                };
                reader.readAsDataURL(files[0]);
            }
        }

        function renderFileList() {
            const container = document.getElementById('fileList');
            container.innerHTML = files.map((file, index) => `
                <div class="file-item" id="file-${index}">
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-status" id="status-${index}">ëŒ€ê¸° ì¤‘</div>
                    </div>
                </div>
            `).join('');
        }

        // ì›Œí„°ë§ˆí¬ ì²˜ë¦¬
        document.getElementById('processBtn').addEventListener('click', async () => {
            if (currentType === 'image' && !logoImage) {
                window.BaalUtils.showToast('ë¡œê³  ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”.', 'error', 5000);
                return;
            }

            if (currentType === 'text' && !document.getElementById('watermarkText').value.trim()) {
                window.BaalUtils.showToast('ì›Œí„°ë§ˆí¬ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error', 5000);
                return;
            }

            const btn = document.getElementById('processBtn');
            btn.disabled = true;

            window.BaalUtils.showLoading();
            processedFiles = [];

            const totalFiles = files.length;

            for (let i = 0; i < files.length; i++) {
                const progress = Math.round(((i) / totalFiles) * 100);
                window.BaalUtils.updateProgress(progress);
                document.getElementById(`status-${i}`).textContent = 'ì²˜ë¦¬ ì¤‘...';

                try {
                    const result = await processImage(files[i]);
                    processedFiles.push(result);
                    document.getElementById(`status-${i}`).textContent = 'ì™„ë£Œ';
                } catch (error) {
                    console.error('Processing error:', error);
                    document.getElementById(`status-${i}`).textContent = 'ì‹¤íŒ¨: ' + error.message;
                }
            }

            // 100% ì™„ë£Œ í‘œì‹œ
            window.BaalUtils.updateProgress(100);

            // ì ê¹ ëŒ€ê¸° í›„ ë¡œë”© ìˆ¨ê¹€
            await new Promise(resolve => setTimeout(resolve, 300));
            window.BaalUtils.hideLoading();
            btn.disabled = false;

            if (processedFiles.length > 0) {
                showPreview(processedFiles[0]);
                renderThumbnails();
                document.getElementById('downloadButtons').style.display = 'flex';
                window.BaalUtils.showToast('ëª¨ë“  ì´ë¯¸ì§€ ì²˜ë¦¬ ì™„ë£Œ!', 'success', 5000);
            }
        });

        async function processImage(file) {
            const img = new Image();
            img.src = URL.createObjectURL(file);
            await img.decode();

            const canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext('2d');

            // ì›ë³¸ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
            ctx.drawImage(img, 0, 0);

            // ì›Œí„°ë§ˆí¬ ì˜µì…˜
            const opacity = parseInt(document.getElementById('opacity').value) / 100;
            const rotation = parseInt(document.getElementById('rotation').value);
            const hasShadow = document.getElementById('shadowToggle').checked;

            if (currentType === 'text') {
                const text = document.getElementById('watermarkText').value;
                const fontSize = parseInt(document.getElementById('fontSize').value);
                const color = document.getElementById('textColor').value;

                addTextWatermark(ctx, canvas.width, canvas.height, {
                    text, fontSize, color, opacity, rotation, hasShadow
                });
            } else {
                const scale = parseInt(document.getElementById('logoScale').value) / 100;
                addImageWatermark(ctx, canvas.width, canvas.height, logoImage, {
                    scale, opacity, rotation
                });
            }

            const blob = await new Promise(resolve => {
                canvas.toBlob(resolve, 'image/png');
            });

            URL.revokeObjectURL(img.src);

            return { name: file.name, blob, canvas };
        }

        function addTextWatermark(ctx, width, height, options) {
            const { text, fontSize, color, opacity, rotation, hasShadow } = options;

            ctx.save();
            ctx.font = `bold ${fontSize}px Arial, sans-serif`;
            const metrics = ctx.measureText(text);
            const textWidth = metrics.width;

            const coords = calculatePosition(width, height, textWidth, fontSize);

            ctx.globalAlpha = opacity;

            if (hasShadow) {
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
            }

            ctx.translate(coords.x, coords.y);
            ctx.rotate(rotation * Math.PI / 180);
            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 0, 0);

            ctx.restore();
        }

        function addImageWatermark(ctx, width, height, logo, options) {
            const { scale, opacity, rotation } = options;

            const logoWidth = logo.width * scale;
            const logoHeight = logo.height * scale;

            const coords = calculatePosition(width, height, logoWidth, logoHeight);

            ctx.save();
            ctx.globalAlpha = opacity;
            ctx.translate(coords.x, coords.y);
            ctx.rotate(rotation * Math.PI / 180);
            ctx.drawImage(logo, -logoWidth / 2, -logoHeight / 2, logoWidth, logoHeight);
            ctx.restore();
        }

        function calculatePosition(canvasWidth, canvasHeight, itemWidth, itemHeight) {
            const offset = 20;
            const positions = {
                'top-left': { x: offset + itemWidth / 2, y: offset + itemHeight / 2 },
                'top-center': { x: canvasWidth / 2, y: offset + itemHeight / 2 },
                'top-right': { x: canvasWidth - offset - itemWidth / 2, y: offset + itemHeight / 2 },
                'center-left': { x: offset + itemWidth / 2, y: canvasHeight / 2 },
                'center': { x: canvasWidth / 2, y: canvasHeight / 2 },
                'center-right': { x: canvasWidth - offset - itemWidth / 2, y: canvasHeight / 2 },
                'bottom-left': { x: offset + itemWidth / 2, y: canvasHeight - offset - itemHeight / 2 },
                'bottom-center': { x: canvasWidth / 2, y: canvasHeight - offset - itemHeight / 2 },
                'bottom-right': { x: canvasWidth - offset - itemWidth / 2, y: canvasHeight - offset - itemHeight / 2 }
            };

            return positions[currentPosition] || positions['bottom-right'];
        }

        function showPreview(result) {
            const canvas = document.getElementById('previewCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = result.canvas.width;
            canvas.height = result.canvas.height;
            ctx.drawImage(result.canvas, 0, 0);

            document.getElementById('placeholder').style.display = 'none';
            canvas.style.display = 'block';
        }

        function renderThumbnails() {
            if (processedFiles.length === 0) return;

            const palette = document.getElementById('thumbnailPalette');
            const grid = document.getElementById('thumbnailGrid');

            grid.innerHTML = processedFiles.map((result, index) => {
                const dataUrl = result.canvas.toDataURL('image/jpeg', 0.7);
                return `
                    <div style="cursor: pointer; border: 2px solid var(--border-color); border-radius: var(--border-radius-sm); overflow: hidden; transition: transform 0.2s, border-color 0.2s;"
                         onclick="showPreview(processedFiles[${index}])"
                         onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='var(--gold-primary)'"
                         onmouseout="this.style.transform='scale(1)'; this.style.borderColor='var(--border-color)'">
                        <img src="${dataUrl}" style="width: 100%; height: 120px; object-fit: cover; display: block;" alt="Thumbnail ${index + 1}">
                        <div style="padding: 6px; background: var(--bg-secondary); font-size: 0.75em; color: var(--text-secondary); text-align: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            ${result.name}
                        </div>
                    </div>
                `;
            }).join('');

            palette.style.display = 'block';
        }

        // ZIP ë‹¤ìš´ë¡œë“œ
        document.getElementById('downloadAllBtn').addEventListener('click', async () => {
            if (processedFiles.length === 0) return;

            window.BaalUtils.showLoading();

            const zip = new JSZip();

            processedFiles.forEach(result => {
                const nameWithoutExt = result.name.replace(/\.[^/.]+$/, '');
                zip.file(`${nameWithoutExt}_watermarked.png`, result.blob);
            });

            const content = await zip.generateAsync({ type: 'blob' });
            window.BaalUtils.downloadFile(content, 'watermarked_images.zip');

            window.BaalUtils.hideLoading();
            window.BaalUtils.showToast('ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!', 'success', 5000);
        });
    </script>
</body>
</html>
